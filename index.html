<!DOCTYPE html>
<html>
<head>
  <title>Crypto Average Chart</title>
  <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
  <style>
    body { margin: 0; background: #000; color: white; font-family: sans-serif; }
    #chart { width: 100%; height: 90vh; }
    #status { padding: 10px; text-align: center; }
  </style>
</head>
<body>
  <div id="status">⏳ Loading chart data...</div>
  <div id="chart"></div>

  <script>
    const symbols = ["BTCUSDT", "ETHUSDT", "LTCUSDT", "BCHUSDT"];
    const limit = 100;

    async function fetchKlines(symbol) {
      const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1h&limit=${limit}`;
      const res = await fetch(url);
      return await res.json();
    }

    async function loadChart() {
      const status = document.getElementById("status");
      try {
        const allData = await Promise.all(symbols.map(s => fetchKlines(s)));

        const candles = [];

        for (let i = 0; i < limit; i++) {
          const time = Math.floor(allData[0][i][0] / 1000);
          let open = 0, high = 0, low = 0, close = 0;

          for (let d = 0; d < allData.length; d++) {
            open  += parseFloat(allData[d][i][1]);
            high  += parseFloat(allData[d][i][2]);
            low   += parseFloat(allData[d][i][3]);
            close += parseFloat(allData[d][i][4]);
          }

          candles.push({
            time,
            open: open / 4,
            high: high / 4,
            low: low / 4,
            close: close / 4
          });
        }

        status.style.display = "none";

        const chart = LightweightCharts.createChart(document.getElementById('chart'), {
          layout: { backgroundColor: '#000', textColor: '#fff' },
          grid: { vertLines: { color: '#222' }, horzLines: { color: '#222' } },
          width: window.innerWidth,
          height: window.innerHeight * 0.9
        });

        const series = chart.addCandlestickSeries();
        series.setData(candles);
      } catch (err) {
        console.error(err);
        status.textContent = "❌ Failed to load data.";
      }
    }

    loadChart();
  </script>
</body>
</html>
